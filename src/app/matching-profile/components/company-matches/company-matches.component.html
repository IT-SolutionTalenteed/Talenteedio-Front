<div class="company-matches-container">
  <!-- Header Section -->
  <div class="matches-header">
    <div class="header-content">
      <button class="btn-back" (click)="back.emit()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Retour
      </button>
      <div class="header-text">
        <h2 class="header-title">
          <span class="title-icon">‚ú®</span>
          Vos entreprises match√©es
        </h2>
        <p class="header-subtitle">D√©couvrez les entreprises qui correspondent le mieux √† votre profil</p>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  <div class="alert-error" *ngIf="error && !matching">
    <div class="alert-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="alert-content">
      <h4>Une erreur est survenue</h4>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="retryMatching()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M1 4V10H7M23 20V14H17M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        R√©essayer
      </button>
    </div>
  </div>

  <!-- No matches yet -->
  <div *ngIf="!loading && !matching && !error && matches.length === 0" class="empty-state">
    <div class="empty-icon">
      <svg width="120" height="120" viewBox="0 0 24 24" fill="none">
        <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h3 class="empty-title">Pr√™t √† d√©couvrir vos matchs ?</h3>
    <p class="empty-text">Lancez l'analyse pour trouver les entreprises qui correspondent parfaitement √† votre profil</p>
    <button 
      class="btn-primary-large"
      (click)="startMatching()"
      [disabled]="hasAttemptedMatching">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Lancer le matching
    </button>
  </div>

  <!-- Matching in progress -->
  <div *ngIf="matching" class="loading-state">
    <div class="loading-animation">
      <div class="loading-spinner"></div>
      <div class="loading-pulse"></div>
    </div>
    <h3 class="loading-title">Analyse en cours...</h3>
    <p class="loading-text">Notre IA analyse votre profil et recherche les meilleures opportunit√©s pour vous</p>
    <div class="loading-steps">
      <div class="step active">
        <div class="step-icon">‚úì</div>
        <span>Analyse du CV</span>
      </div>
      <div class="step active">
        <div class="step-icon">‚ö°</div>
        <span>Matching IA</span>
      </div>
      <div class="step">
        <div class="step-icon">üéØ</div>
        <span>R√©sultats</span>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p class="loading-text">Chargement...</p>
  </div>

  <!-- Matches list -->
  <div *ngIf="!loading && matches.length > 0" class="matches-content">
    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-icon">üè¢</div>
        <div class="stat-info">
          <span class="stat-value">{{ matches.length }}</span>
          <span class="stat-label">Entreprise{{ matches.length > 1 ? 's' : '' }} trouv√©e{{ matches.length > 1 ? 's' : '' }}</span>
        </div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <div class="stat-icon">‚úì</div>
        <div class="stat-info">
          <span class="stat-value">{{ getSelectedCount() }}</span>
          <span class="stat-label">S√©lectionn√©e{{ getSelectedCount() > 1 ? 's' : '' }}</span>
        </div>
      </div>
    </div>

    <!-- Matches Grid -->
    <div class="matches-grid">
      <div class="match-card" *ngFor="let match of matches" [class.selected]="match.isSelected">
        <!-- Match Score Badge -->
        <div class="match-badge" [class.high]="match.matchScore >= 70" [class.medium]="match.matchScore >= 50 && match.matchScore < 70">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="currentColor"/>
          </svg>
          {{ match.matchScore }}% Match
        </div>

        <!-- Company Header -->
        <div class="company-header">
          <div class="company-logo" *ngIf="match.company.logo">
            <img [src]="match.company.logo.fileUrl" [alt]="match.company.company_name">
          </div>
          <div class="company-logo placeholder" *ngIf="!match.company.logo">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <path d="M3 21H21M3 7L12 3L21 7M5 21V10M19 21V10M9 21V14H15V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>

        <!-- Company Info -->
        <div class="company-body">
          <h4 class="company-name">{{ match.company.company_name }}</h4>
          
          <div class="company-meta">
            <div class="meta-item" *ngIf="match.company.contact?.address?.city">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{{ match.company.contact.address.city }}</span>
            </div>
            
            <div class="meta-item" *ngIf="match.company.category">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path d="M20.59 13.41L13.42 20.58C13.2343 20.766 13.0137 20.9135 12.7709 21.0141C12.5281 21.1148 12.2678 21.1666 12.005 21.1666C11.7422 21.1666 11.4819 21.1148 11.2391 21.0141C10.9963 20.9135 10.7757 20.766 10.59 20.58L2 12V2H12L20.59 10.59C20.9625 10.9647 21.1716 11.4716 21.1716 12C21.1716 12.5284 20.9625 13.0353 20.59 13.41Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 7H7.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{{ match.company.category.name }}</span>
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer">
          <button 
            class="btn-select"
            [class.selected]="match.isSelected"
            (click)="toggleSelection(match)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" *ngIf="!match.isSelected">
              <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 8V16M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" *ngIf="match.isSelected">
              <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76489 14.1003 1.98232 16.07 2.86" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ match.isSelected ? 'S√©lectionn√©e' : 'S√©lectionner' }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Actions Bar -->
    <div class="actions-bar">
      <button class="btn-secondary" (click)="startMatching()" [disabled]="matching">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M1 4V10H7M23 20V14H17M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Relancer le matching
      </button>
      <button 
        class="btn-primary-action"
        (click)="next.emit()"
        [disabled]="getSelectedCount() === 0">
        <span>Continuer vers les rendez-vous</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>
