<div class="profile-form-container">
  <div class="card">
    <div class="card-body p-4">
      <h3 class="card-title mb-4">
        <i class="fas fa-user-edit me-2"></i>
        {{ profile?.id ? 'Modifier' : 'Créer' }} votre profil de matching
      </h3>

      <!-- Loading Data -->
      <div class="text-center py-5" *ngIf="loadingData">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="mt-3 text-muted">Chargement des données...</p>
      </div>

      <!-- Success Alert -->
      <div class="alert alert-success alert-dismissible fade show" *ngIf="success">
        <i class="fas fa-check-circle me-2"></i>
        {{ success }}
      </div>

      <!-- Error Alert -->
      <div class="alert alert-danger alert-dismissible fade show" *ngIf="error">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ error }}
        <button type="button" class="btn-close" (click)="error = null"></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" *ngIf="!loadingData">
        <!-- Titre du profil -->
        <div class="mb-4">
          <label for="title" class="form-label">
            Titre du profil <span class="text-danger">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="title" 
            formControlName="title"
            placeholder="Ex: Développeur Full Stack recherche opportunités"
            [class.is-invalid]="form.get('title')?.invalid && form.get('title')?.touched">
          <div class="invalid-feedback" *ngIf="form.get('title')?.invalid && form.get('title')?.touched">
            Le titre est requis (minimum 3 caractères)
          </div>
        </div>

        <!-- CV Upload -->
        <div class="mb-4">
          <label for="cv" class="form-label">
            CV (PDF)
          </label>
          <div 
            class="cv-upload-zone" 
            (click)="triggerFileInput()"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
            [class.drag-over]="isDragOver">
            <input 
              #fileInput
              type="file" 
              class="d-none" 
              id="cv" 
              accept=".pdf"
              (change)="onFileSelected($event)">
            <div class="upload-content">
              <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>
              <p class="mb-2" *ngIf="!selectedFile && !profile?.cv">
                <strong>Glissez-déposez votre CV ici</strong>
              </p>
              <p class="mb-0 text-muted" *ngIf="!selectedFile && !profile?.cv">
                ou cliquez pour sélectionner un fichier PDF
              </p>
              <p class="mb-0 text-success" *ngIf="selectedFile">
                <i class="fas fa-file-pdf me-2"></i>
                {{ selectedFile.name }}
              </p>
              <p class="mb-0" *ngIf="!selectedFile && profile?.cv">
                <i class="fas fa-file-pdf me-2 text-success"></i>
                CV déjà téléchargé
              </p>
            </div>
          </div>
          <small class="form-text text-muted">
            Votre CV sera analysé pour améliorer le matching avec les entreprises
          </small>
        </div>

        <!-- Compétences -->
        <div class="mb-4">
          <label for="skills" class="form-label">
            Compétences
          </label>
          <ng-select
            [items]="skillsOptions"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchable]="true"
            [clearable]="true"
            placeholder="Sélectionnez vos compétences"
            formControlName="skills"
            id="skills"
            [addTag]="true"
            addTagText="Ajouter"
            notFoundText="Aucune compétence trouvée">
          </ng-select>
          <small class="form-text text-muted">
            Sélectionnez vos compétences principales ou ajoutez-en de nouvelles
          </small>
        </div>

        <!-- Centres d'intérêt -->
        <div class="mb-4">
          <label for="interests" class="form-label">
            Centres d'intérêt professionnels
          </label>
          <ng-select
            [items]="interestsOptions"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchable]="true"
            [clearable]="true"
            placeholder="Sélectionnez vos centres d'intérêt"
            formControlName="interests"
            id="interests"
            [addTag]="true"
            addTagText="Ajouter"
            notFoundText="Aucun centre d'intérêt trouvé">
          </ng-select>
          <small class="form-text text-muted">
            Vos domaines d'intérêt pour mieux cibler les entreprises
          </small>
        </div>

        <!-- Secteurs ciblés -->
        <div class="mb-4">
          <label for="targetSectorIds" class="form-label">
            Secteurs d'activité recherchés (optionnel)
          </label>
          <ng-select
            [items]="sectorsOptions"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchable]="true"
            [clearable]="true"
            placeholder="Sélectionnez les secteurs qui vous intéressent"
            formControlName="targetSectorIds"
            id="targetSectorIds"
            [addTag]="true"
            addTagText="Ajouter"
            notFoundText="Aucun secteur trouvé">
          </ng-select>
          <small class="form-text text-muted">
            Secteurs qui vous intéressent (laissez vide pour tous les secteurs)
          </small>
        </div>

        <!-- Actions -->
        <div class="d-flex justify-content-end gap-2">
          <button 
            type="submit" 
            class="btn btn-primary btn-lg"
            [disabled]="loading || form.invalid">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            <i class="fas fa-save me-2" *ngIf="!loading"></i>
            {{ loading ? 'Sauvegarde...' : 'Sauvegarder et continuer' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
